<!DOCTYPE html>
<html>

  <head>
    <title>Average Wordle Score</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/wordle.css">
    <script>
      function calculate() {
        let guesses_array = Array.from(document.getElementsByClassName('guess')).map(x => eval(x.value))
        let total_guesses = guesses_array.reduce((partialSum, a) => partialSum + a, 0)
        
        let scores_array = guesses_array.map((x, i) => x * (i + 1))
        let total_score = scores_array.reduce((partialSum, a) => partialSum + a, 0)

        let average_score = total_score / total_guesses

        if (!isNaN(average_score)) {
          document.getElementById("average_score").innerHTML = Math.round(average_score * 1000) / 1000
          document.getElementById("share_button").style.display = "block";
        }
      }

      function onKeyPress(event, id, value) {
        index = id.slice(-1)
        if (event.keyCode == 13 | event.keyCode == 40) { // "Enter" or "Down"
          calculate()
          if (value > 15) {
            document.getElementById(index).innerHTML = "⬜️".repeat(15) + "➡️"
          } else {
            document.getElementById(index).innerHTML = "⬜️".repeat(value)
          }
          next_id = "guess"+ String(Number(index) + 1)
          document.getElementById(next_id).focus()
        } else if (event.keyCode == 38) {// "Up"
          calculate()
          if (value > 15) {
            document.getElementById(index).innerHTML = "⬜️".repeat(15) + "➡️"
          } else {
            document.getElementById(index).innerHTML = "⬜️".repeat(value)
          }
          prev_id = "guess"+ String(Number(index) - 1)
          document.getElementById(prev_id).focus()
        }
      }

      function share() {
        let share = document.getElementById("average_score")
        console.log(share)

        digits = share.textContent.split("")
        let map = new Map([
          ["0", "0️⃣"],
          ["1", "1️⃣"],
          ["2", "2️⃣"],
          ["3", "3️⃣"],
          ["4", "4️⃣"],
          ["5", "5️⃣"],
          ["6", "6️⃣"],
          ["7", "7️⃣"],
          ["8", "8️⃣"],
          ["9", "9️⃣"],
          [".", "∙"]
        ])
        digits = digits.map(i => map.get(i))
        console.log(map)
        console.log(digits)

        message = "My average Wordle score is:\n" + digits.join("") + "\nhttps://ritotn.github.io/averagewordle"

        navigator.clipboard.writeText(message)

        alert("Copied score to clipboard!")
      } 
    </script>
  </head>

  <body>

    <h2>Average Wordle Score</h2>
    <h1 id="average_score"><wbr></h1>

    <table>
      <tr>
        <td class="left_td"><input type="text" class="guess" placeholder="1" id="guess0" maxlength=3 onkeydown="onKeyPress(event, id, value)"/></td>
        <td class="right_td" id="0"></td>
      </tr>

      <tr>
        <td class="left_td"><input type="text" class="guess" placeholder="2" id="guess1" maxlength=3 onkeydown="onKeyPress(event, id, value)"/></td>
        <td class="right_td" id="1"></td>
      </tr>

      <tr>
        <td class="left_td"><input type="text" class="guess" placeholder="3" id="guess2" maxlength=3 onkeydown="onKeyPress(event, id, value)"/></td>
        <td class="right_td" id="2"></td>
      </tr>

      <tr>
        <td class="left_td"><input type="text" class="guess" placeholder="4" id="guess3" maxlength=3 onkeydown="onKeyPress(event, id, value)"/></td>
        <td class="right_td" id="3"></td>
      </tr>

      <tr>
        <td class="left_td"><input type="text" class="guess" placeholder="5" id="guess4" maxlength=3 onkeydown="onKeyPress(event, id, value)"/></td>
        <td class="right_td" id="4"></td>
      </tr>

      <tr>
        <td class="left_td"><input type="text" class="guess" placeholder="6" id="guess5" maxlength=3 onkeydown="onKeyPress(event, id, value)"/></td>
        <td class="right_td" id="5"></td>
      </tr>
    </table>

    <div id="share_button" class="share_button">
      <button type="button" onclick="share()">Share 🔗</button>
    </div>

  </body>

</html>
